<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Pannello Gamemaster</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .control-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .control-section h3 {
            margin-bottom: 20px;
            color: #ffd700;
            text-align: center;
        }

        .game-controls {
            display: grid;
            gap: 15px;
        }

        .game-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .game-btn:hover {
            background: linear-gradient(45deg, #2980b9, #3498db);
            transform: scale(1.02);
        }

        .game-btn.active {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .game-btn.active:hover {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
        }

        .stop-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            margin-top: 15px;
        }

        .stop-btn:hover {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.8;
        }

        .participants-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .participants-list h3 {
            margin-bottom: 20px;
            color: #ffd700;
            text-align: center;
        }

        .participant-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .participant-row:last-child {
            border-bottom: none;
        }

        .current-status {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .current-status.waiting {
            background: rgba(255, 193, 7, 0.2);
            border-color: #ffc107;
        }

        .message-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .login-form {
            max-width: 400px;
            margin: 100px auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .login-form input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1.1em;
        }

        .login-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
        }

        .login-btn:hover {
            background: linear-gradient(45deg, #ee5a52, #ff6b6b);
        }

        .error {
            color: #e74c3c;
            margin-top: 10px;
            padding: 10px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Pagina di login gamemaster -->
    <div id="login-page">
        <div class="login-form">
            <h2>üéÆ Accesso Gamemaster</h2>
            <form id="login-form">
                <input type="password" id="password" placeholder="Password Gamemaster" required>
                <button type="submit" class="login-btn">Accedi</button>
                <div id="login-error" class="error" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Pannello principale gamemaster -->
    <div id="gamemaster-panel" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>üéÆ Pannello di Controllo Gamemaster</h1>
                <p>Gestisci i giochi della festa in tempo reale</p>
            </div>

            <div class="current-status waiting" id="current-status">
                <h3>üì¢ Stato Attuale</h3>
                <p id="status-text">Nessun gioco attivo - In attesa</p>
                <p id="active-players">0 giocatori connessi</p>
            </div>

            <div class="control-panel">
                <div class="control-section">
                    <h3>üéØ Controllo Giochi</h3>
                    <div class="game-controls">
                        <button class="game-btn" onclick="startGame('quiz_personalizzato')">
                            <span>üß† Quiz Personalizzato</span>
                            <span id="quiz-status">‚óè</span>
                        </button>
                        <button class="game-btn" onclick="startGame('indovina_chi')">
                            <span>üïµÔ∏è Indovina Chi</span>
                            <span id="indovina-status">‚óè</span>
                        </button>
                        <button class="game-btn" onclick="startGame('quiz_squadre')">
                            <span>üë• Quiz a Squadre</span>
                            <span id="squadre-status">‚óè</span>
                        </button>
                        <button class="game-btn" onclick="startGame('votazione_costumi')">
                            <span>üé≠ Votazione Costumi</span>
                            <span id="votazione-status">‚óè</span>
                        </button>
                        <input type="text" class="message-input" id="custom-message" placeholder="Messaggio personalizzato (opzionale)">
                        <button class="stop-btn" onclick="stopGame()">
                            üõë Ferma Gioco Attuale
                        </button>
                    </div>
                </div>

                <div class="control-section">
                    <h3>üìä Statistiche Live</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-players">0</div>
                            <div class="stat-label">Giocatori Totali</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="active-participants">0</div>
                            <div class="stat-label">Nel Gioco Attuale</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="completed-games">0</div>
                            <div class="stat-label">Giochi Completati</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-votes">0</div>
                            <div class="stat-label">Voti Costumi</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="participants-list">
                <h3>üë• Giocatori Registrati</h3>
                <div id="participants-container">
                    <div class="participant-row">
                        <div>
                            <strong>Marco Rossi</strong> - Squadra Rossa
                            <br><small>üè¥‚Äç‚ò†Ô∏è Capitano Pirata</small>
                        </div>
                        <div>150 pt</div>
                    </div>
                    <div class="participant-row">
                        <div>
                            <strong>Sara Bianchi</strong> - Squadra Blu
                            <br><small>üë∏ Principessa Reale</small>
                        </div>
                        <div>130 pt</div>
                    </div>
                    <div class="participant-row">
                        <div>
                            <strong>Luca Verdi</strong> - Squadra Verde
                            <br><small>ü¶∏‚Äç‚ôÇÔ∏è Super Eroe</small>
                        </div>
                        <div>120 pt</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentGame = null;
        let isGamemaster = false;

        // Login del gamemaster
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;

            // Simula login (in realt√† dovrebbe fare una chiamata al server)
            if (password === 'festa2025') {
                isGamemaster = true;
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('gamemaster-panel').style.display = 'block';
                loadGamemasterData();
            } else {
                document.getElementById('login-error').style.display = 'block';
                document.getElementById('login-error').textContent = 'Password errata!';
            }
        });

        function startGame(gameType) {
            if (!isGamemaster) return;

            const customMessage = document.getElementById('custom-message').value;
            const message = customMessage || getDefaultMessage(gameType);

            fetch('/gamemaster/set-game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    gioco: gameType,
                    messaggio: message
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentGame = gameType;
                    updateGameStatus(gameType, message);
                    updateButtonStates();
                    showNotification(`${getGameName(gameType)} avviato!`);
                }
            })
            .catch(error => {
                showNotification('Errore durante l\'avvio del gioco', 'error');
            });
        }

        function stopGame() {
            if (!isGamemaster) return;

            fetch('/gamemaster/stop-game', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentGame = null;
                    updateGameStatus(null, 'In attesa del prossimo gioco...');
                    updateButtonStates();
                    showNotification('Gioco fermato');
                }
            })
            .catch(error => {
                showNotification('Errore', 'error');
            });
        }

        function updateGameStatus(game, message) {
            const statusElement = document.getElementById('current-status');
            const statusText = document.getElementById('status-text');

            if (game) {
                statusElement.className = 'current-status';
                statusText.textContent = `${getGameName(game)} - ${message}`;
            } else {
                statusElement.className = 'current-status waiting';
                statusText.textContent = message;
            }
        }

        function updateButtonStates() {
            const buttons = document.querySelectorAll('.game-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });

            if (currentGame) {
                const activeBtn = document.querySelector(`[onclick*="${currentGame}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
        }

        function getGameName(gameType) {
            const names = {
                'quiz_personalizzato': 'Quiz Personalizzato',
                'indovina_chi': 'Indovina Chi',
                'quiz_squadre': 'Quiz a Squadre',
                'votazione_costumi': 'Votazione Costumi'
            };
            return names[gameType] || gameType;
        }

        function getDefaultMessage(gameType) {
            const messages = {
                'quiz_personalizzato': '√à ora di testare quanto conoscete il festeggiato!',
                'indovina_chi': 'Riuscite a indovinare chi si nasconde dietro ogni indizio?',
                'quiz_squadre': 'Lavorate in squadra per vincere!',
                'votazione_costumi': 'Votate il costume pi√π bello della serata!'
            };
            return messages[gameType] || 'Nuovo gioco disponibile!';
        }

        function loadGamemasterData() {
            // Carica dati iniziali
            updateStats();
            updateParticipants();

            // Aggiorna ogni 5 secondi
            setInterval(updateStats, 5000);
            setInterval(updateParticipants, 10000);
        }

        function updateStats() {
            // Simula aggiornamento statistiche
            document.getElementById('total-players').textContent = '12';
            document.getElementById('active-participants').textContent = currentGame ? '8' : '0';
            document.getElementById('completed-games').textContent = '2';
            document.getElementById('total-votes').textContent = '7';
            document.getElementById('active-players').textContent = '12 giocatori connessi';
        }

        function updateParticipants() {
            // In una vera implementazione, questo dovrebbe fare una chiamata API
            // per ottenere la lista aggiornata dei partecipanti
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                background: ${type === 'error' ? '#e74c3c' : '#27ae60'};
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Controlla lo stato iniziale quando la pagina si carica
        window.onload = function() {
            // Mostra sempre la pagina di login inizialmente
            document.getElementById('login-page').style.display = 'block';
            document.getElementById('gamemaster-panel').style.display = 'none';
        };
    </script>
</body>
</html>